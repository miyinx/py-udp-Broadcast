# udpå±€åŸŸç½‘å®æ—¶å¹¿æ’­ç³»ç»Ÿ

æœ¬ç³»ç»Ÿå®ç°åŸºäºPythonå’ŒUDPåè®®çš„ç‚¹å¯¹å¤šç‚¹å®æ—¶éŸ³è§†é¢‘ä¼ è¾“ï¼Œæ”¯æŒå±å¹•å…±äº«ã€æ‘„åƒå¤´ç›´æ’­ä¸éŸ³é¢‘å¹¿æ’­çš„çµæ´»ç»„åˆä¼ è¾“ã€‚
åŸºäºå®ç°çš„ä½å»¶è¿Ÿå±€åŸŸç½‘å±å¹•/æ‘„åƒå¤´å¹¿æ’­ç³»ç»Ÿï¼Œæ”¯æŒéŸ³é¢‘åŒæ­¥ä¼ è¾“ä¸å®æ—¶æµé‡ç›‘æ§ã€‚

|æ¨¡å—|æŠ€æœ¯æ–¹æ¡ˆ|
| ------| -----------------------------------------------|
|**å¼€å‘è¯­è¨€**|Python 3.9ï¼ˆå…¼é¡¾å¼€å‘æ•ˆç‡ä¸è·¨å¹³å°ç‰¹æ€§ï¼‰|
|**ç½‘ç»œåè®®**|UDPåè®®ï¼ˆé¢å‘æ— è¿æ¥ä¼ è¾“ï¼Œé‡‡ç”¨ç«¯å£å¤ç”¨æŠ€æœ¯ï¼‰|
|**è§†é¢‘å¤„ç†**|OpenCV/PyAVï¼ˆæ‘„åƒå¤´é‡‡é›†ï¼‰+ Pillowï¼ˆå±å¹•æ•è·ï¼‰|
|**éŸ³é¢‘å¤„ç†**|PyAudioï¼ˆWASAPIéŸ³é¢‘æ¥å£ï¼Œä½å»¶è¿Ÿé‡‡é›†ï¼‰|
|**æ•°æ®å‹ç¼©**|ZLIBå‹ç¼©ç®—æ³•ï¼ˆDEFLATEå‹ç¼©ï¼Œå‹ç¼©æ¯”å¯è¾¾70%ï¼‰|
|**çº¿ç¨‹ç®¡ç†**|å¤šçº¿ç¨‹æ¶æ„ï¼ˆè§†é¢‘/éŸ³é¢‘ç‹¬ç«‹çº¿ç¨‹ï¼ŒGILé”ä¼˜åŒ–ï¼‰|
|**GUIæ¡†æ¶**|Tkinterï¼ˆè½»é‡çº§ç•Œé¢ï¼Œæ”¯æŒè·¨å¹³å°æ¸²æŸ“ï¼‰|

## ğŸ“Œ åŠŸèƒ½ç‰¹æ€§

### å‘é€ç«¯åŠŸèƒ½

â€‹![image](assets/BroadcastSender1.6.png)â€‹

* **è§†é¢‘å¤šæºè¾“å…¥åˆ‡æ¢**

  * æ”¯æŒå±å¹•æ•è·ï¼ˆPIL.ImageGrabï¼‰
  * æ”¯æŒæ‘„åƒå¤´å®æ—¶é‡‡é›†ï¼ˆOpenCVï¼Œå…¼å®¹ä¸»æµè§†é¢‘é‡‡é›†è®¾å¤‡ï¼‰
  * é€šè¿‡å•é€‰æŒ‰é’®å®ç°è¾“å…¥æºçƒ­åˆ‡æ¢ï¼ˆæ— éœ€é‡å¯ç¨‹åºåˆ‡æ¢è¾“å…¥æºï¼‰
  * æ™ºèƒ½å‹ç¼©ä¼ è¾“ï¼ˆzlibå‹ç¼©ç®—æ³•ï¼‰

     [zlib --- ä¸ gzip å…¼å®¹çš„å‹ç¼© â€” Python 3.13.3 æ–‡æ¡£](https://docs.python.org/zh-cn/3/library/zlib.html)
* **éŸ³é¢‘ä¼ è¾“**

  * éº¦å…‹é£éŸ³é¢‘é‡‡é›†ï¼ˆPyAudioï¼Œ44.1kHzé‡‡æ ·ç‡ï¼Œ16ä½é‡åŒ–ï¼‰
  * åŠ¨æ€éŸ³é¢‘çº¿ç¨‹ç®¡ç†ï¼ˆæ”¯æŒå¹¿æ’­è¿‡ç¨‹ä¸­éšæ—¶å¯åœéŸ³é¢‘ä¼ è¾“ï¼‰
  * è®¾è®¡èµ„æºå›æ”¶æœºåˆ¶ï¼ˆé˜²æ­¢éŸ³é¢‘è®¾å¤‡æŒç»­è¢«å ç”¨ï¼‰
* **ç½‘ç»œä¼ è¾“**

  * UDPå¹¿æ’­ä¼ è¾“ï¼ˆ255.255.255.255å…¨ç½‘æ®µè¦†ç›–ï¼‰
  * è§†é¢‘/éŸ³é¢‘åˆ†ç«¯å£ä¼ è¾“ï¼ˆè§†é¢‘22222ç«¯å£ï¼ŒéŸ³é¢‘22223ç«¯å£ï¼‰
  * æ•°æ®åˆ†ç‰‡ä¼ è¾“ï¼ˆä½¿ç”¨60KBæ•°æ®åŒ…å¯¹å›¾åƒæ•°æ®åˆ†ç‰‡å‘é€ï¼‰
  * ä¼ è¾“æ§åˆ¶åè®®ï¼ˆstart/over/closeæŒ‡ä»¤ï¼‰
* **æ§åˆ¶ç®¡ç†**

  * ä¼ è¾“çŠ¶æ€å®æ—¶ç›‘æ§ï¼ˆå¯è§†åŒ–å¹¿æ’­çŠ¶æ€æŒ‡ç¤ºï¼‰
  * å¹¿æ’­å¯åœæ§åˆ¶ï¼ˆå¸¦çŠ¶æ€æŒ‡ç¤ºï¼‰
  * éŸ³é¢‘ä¼ è¾“åŠ¨æ€å¼€å…³
  * æµé‡æ§åˆ¶æœºåˆ¶ï¼ˆå±å¹•ä¼ è¾“25FPSï¼Œæ‘„åƒå¤´10FPSï¼‰
  * å®‰å…¨é€€å‡ºæœºåˆ¶ï¼ˆå¯å‘é€å…³é—­æŒ‡ä»¤å¼ºåˆ¶å…³é—­æ¥æ”¶ç«¯ï¼‰

â€

### æ¥æ”¶ç«¯åŠŸèƒ½

â€‹![image](assets/è™šæ‹Ÿæœºè¿è¡Œreceiver.png)â€‹

* **å¤šæµå¤„ç†**

  * è§†é¢‘/éŸ³é¢‘å¹¶è¡Œæ¥æ”¶ï¼ˆç‹¬ç«‹çº¿ç¨‹å¤„ç†ï¼‰
  * åŒç«¯å£ç›‘å¬æœºåˆ¶
  * å®æ—¶è§£ç æ¸²æŸ“ï¼ˆPILå›¾åƒå¤„ç†åŠ é€Ÿï¼‰
* **æ˜¾ç¤ºä¼˜åŒ–**

  * è‡ªé€‚åº”çª—å£å¡«å……ï¼ˆPIL.Image.resizeï¼‰
  * æ™ºèƒ½ç”»é¢å¡«å……ï¼ˆä¿æŒåŸå§‹æ¯”ä¾‹è‡ªåŠ¨å±…ä¸­ï¼‰
  * åŠ¨æ€åˆ†è¾¨ç‡é€‚é…ï¼ˆè‡ªåŠ¨åŒ¹é…å‘é€ç«¯åˆ†è¾¨ç‡ï¼‰
* **äº¤äº’åŠŸèƒ½**

  * æ”¯æŒçª—å£ç½®é¡¶ç®¡ç†ï¼ˆå³é”®èœå•å¿«é€Ÿåˆ‡æ¢ï¼‰
  * æ‹–æ‹½å®šä½æ”¯æŒï¼ˆä»»æ„ä½ç½®æ‹–åŠ¨çª—å£ï¼‰
  * å®‰å…¨é€€å‡ºæµç¨‹ï¼ˆèµ„æºå›æ”¶æœºåˆ¶ï¼‰
* **å®¹é”™æœºåˆ¶**

  * æ•°æ®åŒ…æ ¡éªŒï¼ˆzlib.decompressobj ç›¸å½“äºCRC32æ ¡éªŒï¼Œ`from zlib import decompress`â€‹ï¼‰
  * å¼‚å¸¸æ•°æ®ä¸¢å¼ƒï¼ˆé˜²æ­¢æ•°æ®æ±¡æŸ“ï¼‰
  * æ–­æµè‡ªåŠ¨æ¢å¤ï¼ˆæ¥æ”¶è¶…æ—¶é‡è¿ï¼‰

### ç›‘æ§å·¥å…·
â€‹![image](assets/monitor_running.png)

â€‹![image](assets/monitor_running2.png)

- å®æ—¶å¸¦å®½ç»Ÿè®¡ï¼ˆè§†é¢‘/éŸ³é¢‘/æ€»è®¡ï¼‰
- å¯è§†åŒ–æµé‡æ›²çº¿
- å¯è°ƒæ•´åˆ·æ–°é¢‘ç‡

## â™¨ ç›¸å…³ç»“æ„
### é‡‡ç”¨scç»“æ„
```mermaid
graph TD
    A[å‘é€ç«¯] -->|UDPå¹¿æ’­| B[æ¥æ”¶ç«¯]
    subgraph å‘é€ç«¯
        A1[è§†é¢‘é‡‡é›†æ¨¡å—] --> A2[æ•°æ®å‹ç¼©]
        A3[éŸ³é¢‘é‡‡é›†æ¨¡å—] --> A4[æ•°æ®å‹ç¼©]
        A2 --> A5[ç½‘ç»œä¼ è¾“æ¨¡å—]
        A4 --> A5
    end
    subgraph æ¥æ”¶ç«¯
        B1[ç½‘ç»œæ¥æ”¶æ¨¡å—] --> B2[è§†é¢‘è§£å‹æ˜¾ç¤º]
        B1 --> B3[éŸ³é¢‘è§£å‹æ’­æ”¾]
    end
```
### æ ¸å¿ƒæµç¨‹
```mermaid
sequenceDiagram
    participant GUI
    participant VideoThread
    participant AudioThread
    participant Network
  
    GUI->>VideoThread: å¯åŠ¨è§†é¢‘çº¿ç¨‹
    activate VideoThread
    VideoThread->>Network: å‘é€startæ ‡è®°
    loop å¸§å¾ªç¯
        VideoThread->>VideoThread: æ•è·å±å¹•/æ‘„åƒå¤´
        VideoThread->>VideoThread: å‹ç¼©å›¾åƒæ•°æ®
        VideoThread->>Network: åˆ†å—å‘é€æ•°æ®
    end
    VideoThread->>Network: å‘é€_overæ ‡è®°
    deactivate VideoThread
  
    GUI->>AudioThread: å¯åŠ¨éŸ³é¢‘çº¿ç¨‹
    activate AudioThread
    loop éŸ³é¢‘é‡‡é›†
        AudioThread->>AudioThread: è¯»å–éŸ³é¢‘æµ
        AudioThread->>AudioThread: å‹ç¼©éŸ³é¢‘æ•°æ®
        AudioThread->>Network: å‘é€è‡³22223ç«¯å£
    end
    deactivate AudioThread
```
## ğŸ› ï¸ è¿è¡Œç¯å¢ƒ

```bash
Python 3.6+ | pip install -r requirements.txt

requirements.txtï¼š

Pillow == 9.5.0
opencv-python == 4.5.5.64
pyaudio == 0.2.13
zlib == 1.2.11
```


